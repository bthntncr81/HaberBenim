<div class="audit-page">
  <header class="page-header">
    <h1>üìã Audit Logs</h1>
    <p class="subtitle">View all API request logs for security and debugging</p>
  </header>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <label>From</label>
      <input type="date" [(ngModel)]="fromDate">
    </div>
    <div class="filter-group">
      <label>To</label>
      <input type="date" [(ngModel)]="toDate">
    </div>
    <div class="filter-group">
      <label>User Email</label>
      <input type="text" [(ngModel)]="userEmail" placeholder="e.g. admin@...">
    </div>
    <div class="filter-group">
      <label>Path Contains</label>
      <input type="text" [(ngModel)]="pathFilter" placeholder="e.g. /api/v1/editorial">
    </div>
    <div class="filter-group">
      <label>Status Code</label>
      <input type="number" [(ngModel)]="statusCodeFilter" placeholder="e.g. 200, 401">
    </div>
    <div class="filter-buttons">
      <button class="btn-search" (click)="applyFilters()">
        üîç Search
      </button>
      <button class="btn-clear" (click)="clearFilters()">
        ‚úï Clear
      </button>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading audit logs...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-state">
      <span class="error-icon">‚ö†Ô∏è</span>
      <p>{{ error() }}</p>
      <button class="btn-retry" (click)="loadLogs()">Retry</button>
    </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && !error() && logs().length === 0) {
    <div class="empty-state">
      <span class="empty-icon">üì≠</span>
      <p>No audit logs found</p>
    </div>
  }

  <!-- Table -->
  @if (!isLoading() && !error() && logs().length > 0) {
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Time</th>
            <th>User</th>
            <th>Method</th>
            <th>Path</th>
            <th>Status</th>
            <th>Duration</th>
            <th>IP</th>
          </tr>
        </thead>
        <tbody>
          @for (log of logs(); track log.id) {
            <tr>
              <td class="date-cell">{{ formatDate(log.createdAtUtc) }}</td>
              <td class="user-cell">
                @if (log.userEmail) {
                  <span class="user-email">{{ log.userEmail }}</span>
                } @else {
                  <span class="anonymous">Anonymous</span>
                }
              </td>
              <td>
                <span class="method-badge" [class]="getMethodClass(log.method)">
                  {{ log.method }}
                </span>
              </td>
              <td class="path-cell">
                <span class="path-text" [title]="log.path">
                  {{ log.path.length > 50 ? log.path.substring(0, 50) + '...' : log.path }}
                </span>
              </td>
              <td>
                <span class="status-badge" [class]="getStatusClass(log.statusCode)">
                  {{ log.statusCode }}
                </span>
              </td>
              <td>
                <span class="duration-badge" [class]="getDurationClass(log.durationMs)">
                  {{ log.durationMs }}ms
                </span>
              </td>
              <td class="ip-cell">
                {{ log.ipAddress || '-' }}
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination">
      <button 
        class="btn-page" 
        (click)="prevPage()" 
        [disabled]="currentPage() === 1"
      >
        ‚Üê Prev
      </button>
      <span class="page-info">
        Page {{ currentPage() }} ¬∑ {{ totalItems() }} logs
      </span>
      <button 
        class="btn-page" 
        (click)="nextPage()"
        [disabled]="currentPage() * pageSize() >= totalItems()"
      >
        Next ‚Üí
      </button>
    </div>
  }
</div>

