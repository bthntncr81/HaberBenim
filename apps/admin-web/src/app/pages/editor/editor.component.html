<div class="editor-page">
  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Loading content...</p>
    </div>
  } @else if (item()) {
    <!-- Header -->
    <header class="editor-header">
      <div class="header-left">
        <button class="btn-back" (click)="goBack()">‚Üê Back</button>
        <div class="header-info">
          <h1>{{ item()!.title }}</h1>
          <div class="meta-row">
            <span class="source-badge">{{ item()!.sourceName }}</span>
            <span class="status-badge" [class]="getStatusClass(item()!.status)">
              {{ item()!.status }}
            </span>
            @if (item()!.scheduledAtUtc) {
              <span class="scheduled-info">üìÖ {{ formatDate(item()!.scheduledAtUtc) }}</span>
            }
          </div>
        </div>
      </div>
      <div class="header-actions">
        <button 
          class="btn-save" 
          (click)="saveDraft()"
          [disabled]="isSaving()"
        >
          @if (isSaving()) {
            <span class="spinner-sm"></span>
          }
          üíæ Save Draft
        </button>
        @if (canApproveRejectSchedule) {
          <button 
            class="btn-approve" 
            (click)="approve()"
            [disabled]="isApproving()"
          >
            @if (isApproving()) {
              <span class="spinner-sm"></span>
            }
            ‚úÖ Approve
          </button>
          <button 
            class="btn-reject" 
            (click)="openRejectModal()"
          >
            ‚ùå Reject
          </button>
          <button 
            class="btn-schedule" 
            (click)="openScheduleModal()"
          >
            üìÖ Schedule
          </button>
        }
        @if (canEnqueuePublish) {
          <button 
            class="btn-enqueue" 
            (click)="enqueuePublish()"
            [disabled]="isEnqueueing()"
          >
            @if (isEnqueueing()) {
              <span class="spinner-sm"></span>
            }
            üöÄ Publish
          </button>
        }
        <button class="btn-logs" (click)="viewPublishLogs()">
          üìã Logs
        </button>
      </div>
    </header>

    <!-- Breaking News Badge -->
    @if (isBreaking) {
      <div class="breaking-badge-banner">
        <span class="breaking-icon">üî¥</span>
        <span class="breaking-text">BREAKING NEWS</span>
      </div>
    }

    <!-- Correction Banner for Published Items -->
    @if (isPublished) {
      <div class="correction-banner">
        <div class="correction-info">
          <span class="correction-icon">‚úèÔ∏è</span>
          <div class="correction-text">
            <strong>Correction Mode</strong>
            <span>This content is already published. Make edits and save a correction to republish.</span>
          </div>
          <div class="version-info">
            <span class="version-label">Current Version:</span>
            <span class="version-number">v{{ currentVersionNo }}</span>
            <span class="version-label">Last Action:</span>
            <span class="version-action">{{ lastActionType }}</span>
          </div>
        </div>
        @if (canCorrect) {
          <div class="correction-actions">
            <button 
              class="btn-correction" 
              (click)="openCorrectionModal()"
              [disabled]="isCorrecting()"
            >
              @if (isCorrecting()) {
                <span class="spinner-sm"></span>
              }
              üìù Save & Republish Correction
            </button>
            @if (canRetract) {
              <button 
                class="btn-retract" 
                (click)="openRetractModal()"
                [disabled]="isRetracting()"
              >
                üö´ Retract
              </button>
            }
            <button 
              class="btn-view-publishing" 
              (click)="goToPublishing()"
            >
              üìä View in Publishing
            </button>
          </div>
        }
      </div>
    }

    <!-- Mark Breaking Button (for non-published items) -->
    @if (!isPublished && canMarkBreaking && !isBreaking) {
      <div class="breaking-action-banner">
        <div class="breaking-action-info">
          <span class="breaking-icon">‚ö°</span>
          <span>Need to fast-track this content?</span>
        </div>
        <button 
          class="btn-mark-breaking" 
          (click)="openBreakingModal()"
          [disabled]="isMarkingBreaking()"
        >
          @if (isMarkingBreaking()) {
            <span class="spinner-sm"></span>
          }
          üî¥ Mark as Breaking News
        </button>
      </div>
    }

    <div class="editor-content">
      <!-- Main Editor Area -->
      <div class="editor-main">
        <!-- Tabs -->
        <div class="tabs">
          <button 
            class="tab" 
            [class.active]="activeTab() === 'x'"
            (click)="setActiveTab('x')"
          >
            ùïè X/Twitter
          </button>
          <button 
            class="tab" 
            [class.active]="activeTab() === 'web'"
            (click)="setActiveTab('web')"
          >
            üåê Web
          </button>
          <button 
            class="tab" 
            [class.active]="activeTab() === 'mobile'"
            (click)="setActiveTab('mobile')"
          >
            üì± Mobile
          </button>
          <button 
            class="tab" 
            [class.active]="activeTab() === 'push'"
            (click)="setActiveTab('push')"
          >
            üîî Push
          </button>
          <button 
            class="tab" 
            [class.active]="activeTab() === 'meta'"
            (click)="setActiveTab('meta')"
          >
            ‚öôÔ∏è Meta
          </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
          <!-- X Tab -->
          @if (activeTab() === 'x') {
            <div class="tab-panel">
              <div class="form-group">
                <label>X/Twitter Text</label>
                <textarea 
                  [(ngModel)]="draft.xText" 
                  rows="6"
                  placeholder="Enter tweet text..."
                ></textarea>
                <div class="char-counter" [class.warning]="xCharWarning">
                  {{ xCharCount }} / 280
                </div>
              </div>
              <div class="preview-section">
                <h4>Preview</h4>
                <div class="x-preview">
                  <div class="x-avatar">{{ item()!.sourceName.charAt(0) }}</div>
                  <div class="x-content">
                    <div class="x-header">
                      <span class="x-name">{{ item()!.sourceName }}</span>
                      <span class="x-handle">&#64;source</span>
                    </div>
                    <div class="x-text">{{ draft.xText }}</div>
                  </div>
                </div>
              </div>
            </div>
          }

          <!-- Web Tab -->
          @if (activeTab() === 'web') {
            <div class="tab-panel">
              <div class="form-group">
                <label>Web Title</label>
                <input type="text" [(ngModel)]="draft.webTitle" placeholder="Article title...">
              </div>
              <div class="form-group">
                <label>Web Body</label>
                <textarea 
                  [(ngModel)]="draft.webBody" 
                  rows="12"
                  placeholder="Full article body..."
                ></textarea>
              </div>
            </div>
          }

          <!-- Mobile Tab -->
          @if (activeTab() === 'mobile') {
            <div class="tab-panel">
              <div class="form-group">
                <label>Mobile Summary</label>
                <textarea 
                  [(ngModel)]="draft.mobileSummary" 
                  rows="4"
                  placeholder="Short summary for mobile app..."
                  maxlength="500"
                ></textarea>
                <span class="hint">Max 500 characters for mobile display</span>
              </div>
            </div>
          }

          <!-- Push Tab -->
          @if (activeTab() === 'push') {
            <div class="tab-panel">
              <div class="form-group">
                <label>Push Notification Title</label>
                <input 
                  type="text" 
                  [(ngModel)]="draft.pushTitle" 
                  placeholder="Notification title..."
                  maxlength="100"
                >
                <span class="hint">Max 100 characters</span>
              </div>
              <div class="form-group">
                <label>Push Notification Body</label>
                <textarea 
                  [(ngModel)]="draft.pushBody" 
                  rows="3"
                  placeholder="Notification body..."
                  maxlength="300"
                ></textarea>
                <span class="hint">Max 300 characters</span>
              </div>
              <div class="preview-section">
                <h4>Preview</h4>
                <div class="push-preview">
                  <div class="push-icon">üì∞</div>
                  <div class="push-content">
                    <div class="push-title">{{ draft.pushTitle || 'Notification Title' }}</div>
                    <div class="push-body">{{ draft.pushBody || 'Notification body text...' }}</div>
                  </div>
                </div>
              </div>
            </div>
          }

          <!-- Meta Tab -->
          @if (activeTab() === 'meta') {
            <div class="tab-panel">
              <!-- Channel Toggles Section -->
              <div class="channels-section">
                <h4>üì° Publishing Channels</h4>
                <p class="channels-hint">Disabled channels will be skipped during publishing</p>
                <div class="channel-toggles">
                  <label class="toggle-item">
                    <input type="checkbox" [(ngModel)]="draft.publishToWeb">
                    <span class="toggle-label">üåê Web</span>
                  </label>
                  <label class="toggle-item">
                    <input type="checkbox" [(ngModel)]="draft.publishToMobile">
                    <span class="toggle-label">üì± Mobile</span>
                  </label>
                  <label class="toggle-item">
                    <input type="checkbox" [(ngModel)]="draft.publishToX">
                    <span class="toggle-label">ùïè X/Twitter</span>
                  </label>
                  <label class="toggle-item">
                    <input type="checkbox" [(ngModel)]="draft.publishToInstagram">
                    <span class="toggle-label">üì∑ Instagram</span>
                  </label>
                </div>
              </div>

              <!-- Instagram Caption Override -->
              @if (draft.publishToInstagram) {
                <div class="form-group instagram-caption-group">
                  <label>üì∑ Instagram Yazƒ±sƒ± (Opsiyonel)</label>
                  <textarea 
                    [(ngModel)]="draft.instagramCaptionOverride" 
                    rows="3"
                    maxlength="2200"
                    placeholder="Bo≈ü bƒ±rakƒ±rsanƒ±z otomatik olu≈üturulur (ba≈ülƒ±k + √∂zet + hashtag)..."
                  ></textarea>
                  <span class="hint">Max 2200 karakter. Instagram payla≈üƒ±mƒ± i√ßin g√∂rsel zorunludur.</span>
                </div>
              }
              
              <!-- Template Application Section -->
              <div class="template-section">
                <h4>üé® Apply Template</h4>
                <p class="template-hint">Apply source-assigned templates to generate captions for each platform</p>
                
                <div class="template-buttons">
                  @for (platform of templatePlatforms; track platform) {
                    <button 
                      class="btn-apply-template"
                      [class.applied]="hasTemplateResult(platform)"
                      [class.loading]="isApplyingTemplate() === platform"
                      (click)="applyTemplate(platform)"
                      [disabled]="isApplyingTemplate()"
                    >
                      @if (isApplyingTemplate() === platform) {
                        <span class="spinner-xs"></span>
                      } @else {
                        <span class="platform-icon">{{ getPlatformIcon(platform) }}</span>
                      }
                      <span class="platform-name">{{ platform }}</span>
                      @if (hasTemplateResult(platform)) {
                        <span class="applied-badge">‚úì</span>
                      }
                    </button>
                  }
                </div>
                
                <!-- Applied Template Results -->
                @for (platform of templatePlatforms; track platform) {
                  @if (getTemplateResult(platform); as result) {
                    @if (result.success && result.selectedTemplateId) {
                      <div class="template-result">
                        <div class="result-header">
                          <span class="result-platform">{{ getPlatformIcon(platform) }} {{ platform }}</span>
                          <span class="result-template">{{ result.selectedTemplateName }}</span>
                          <span class="result-format">{{ result.format }}</span>
                        </div>
                        @if (result.resolvedTextSpec) {
                          <div class="result-preview">
                            @if (platform === 'Instagram' && result.resolvedTextSpec.instagramCaption) {
                              <div class="preview-text">{{ result.resolvedTextSpec.instagramCaption }}</div>
                            }
                            @if (platform === 'X' && result.resolvedTextSpec.xText) {
                              <div class="preview-text">{{ result.resolvedTextSpec.xText }}</div>
                            }
                            @if (platform === 'TikTok' && result.resolvedTextSpec.tiktokHook) {
                              <div class="preview-text">{{ result.resolvedTextSpec.tiktokHook }}</div>
                            }
                            @if (platform === 'YouTube') {
                              @if (result.resolvedTextSpec.youtubeTitle) {
                                <div class="preview-label">Title:</div>
                                <div class="preview-text">{{ result.resolvedTextSpec.youtubeTitle }}</div>
                              }
                              @if (result.resolvedTextSpec.youtubeDescription) {
                                <div class="preview-label">Description:</div>
                                <div class="preview-text small">{{ result.resolvedTextSpec.youtubeDescription }}</div>
                              }
                            }
                          </div>
                        }
                        @if (result.previewVisualUrl) {
                          <div class="result-visual">
                            <img [src]="result.previewVisualUrl" alt="Template preview" loading="lazy">
                          </div>
                        }
                      </div>
                    }
                  }
                }
              </div>
              
              <!-- Render Final Section -->
              <div class="render-section">
                <h4>üñºÔ∏è Render Final</h4>
                <p class="render-hint">Generate final render images for publishing</p>
                
                <div class="render-buttons">
                  @for (platform of templatePlatforms; track platform) {
                    <button 
                      class="btn-render"
                      [class.rendering]="isRenderingFinal() === platform"
                      [class.completed]="getRenderJob(platform)?.status === 'Completed'"
                      (click)="renderFinal(platform)"
                      [disabled]="isRenderingFinal()"
                    >
                      @if (isRenderingFinal() === platform) {
                        <span class="spinner-xs"></span>
                      } @else {
                        <span class="platform-icon">{{ getPlatformIcon(platform) }}</span>
                      }
                      <span class="platform-name">{{ platform }}</span>
                      @if (getRenderJob(platform); as job) {
                        @if (job.outputType === 'Video') {
                          <span class="type-badge video">üé¨</span>
                        }
                        @if (job.status === 'Rendering' && job.progress > 0) {
                          <span class="render-status rendering">{{ job.progress }}%</span>
                        } @else {
                          <span class="render-status" [class]="getRenderStatusClass(job.status)">
                            {{ getRenderStatusLabel(job.status) }}
                          </span>
                        }
                      }
                    </button>
                  }
                  <button 
                    class="btn-render-all"
                    (click)="renderAllPlatforms()"
                    [disabled]="isRenderingFinal()"
                  >
                    @if (isRenderingFinal() === 'all') {
                      <span class="spinner-xs"></span>
                    }
                    üöÄ Render All
                  </button>
                </div>
                
                <!-- Render Results -->
                @for (platform of templatePlatforms; track platform) {
                  @if (getRenderJob(platform); as job) {
                    @if (job.status === 'Completed' && job.outputUrl) {
                      <div class="render-result" [class.video-render]="job.outputType === 'Video'">
                        <div class="render-result-header">
                          <span class="result-platform">{{ getPlatformIcon(platform) }} {{ platform }}</span>
                          <span class="result-template">{{ job.templateName }}</span>
                          <span class="result-format">{{ job.format }}</span>
                          @if (job.outputType === 'Video') {
                            <span class="result-type video">üé¨ Video</span>
                          }
                        </div>
                        <div class="render-result-preview">
                          @if (job.outputType === 'Video') {
                            <video controls playsinline preload="metadata" class="result-video">
                              <source [src]="job.outputUrl" type="video/mp4">
                              Your browser does not support the video tag.
                            </video>
                          } @else {
                            <img [src]="job.outputUrl" [alt]="job.templateName" loading="lazy">
                          }
                        </div>
                        @if (job.resolvedTextSpecJson) {
                          @if (parseResolvedText(job.resolvedTextSpecJson); as texts) {
                            @if (platform === 'Instagram' && texts['instagramCaption']) {
                              <div class="render-result-text">
                                <label>Instagram Caption</label>
                                <pre>{{ texts['instagramCaption'] }}</pre>
                              </div>
                            }
                            @if (platform === 'X' && texts['xText']) {
                              <div class="render-result-text">
                                <label>X/Twitter Text</label>
                                <pre>{{ texts['xText'] }}</pre>
                              </div>
                            }
                          }
                        }
                      </div>
                    }
                    @if (job.status === 'Failed' && job.error) {
                      <div class="render-error-block">
                        <span class="error-icon">‚ö†Ô∏è</span>
                        <span>{{ platform }}: {{ job.error }}</span>
                      </div>
                    }
                  }
                }
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Hashtags (comma-separated)</label>
                  <input 
                    type="text" 
                    [(ngModel)]="draft.hashtagsCsv" 
                    placeholder="#breaking, #news, ..."
                  >
                </div>
                <div class="form-group">
                  <label>Mentions (comma-separated)</label>
                  <input 
                    type="text" 
                    [(ngModel)]="draft.mentionsCsv" 
                    placeholder="@user1, @user2, ..."
                  >
                </div>
              </div>
              <div class="form-group">
                <label>Editorial Note</label>
                <textarea 
                  [(ngModel)]="draft.editorialNote" 
                  rows="3"
                  placeholder="Internal notes for editors..."
                ></textarea>
              </div>
              @if (item()!.canonicalUrl) {
                <div class="form-group">
                  <label>Original URL</label>
                  <a [href]="item()!.canonicalUrl" target="_blank" class="url-link">
                    {{ item()!.canonicalUrl }}
                    <span class="external-icon">‚Üó</span>
                  </a>
                </div>
              }
              @if (item()!.rejectionReason) {
                <div class="rejection-box">
                  <label>Rejection Reason</label>
                  <p>{{ item()!.rejectionReason }}</p>
                </div>
              }
            </div>
          }
        </div>
      </div>

      <!-- Sidebar: Revisions -->
      <div class="editor-sidebar">
        <!-- Media Section -->
        <div class="sidebar-section media-section">
          <div class="section-header">
            <h3>üñºÔ∏è Medya</h3>
            @if (isLoadingMedia()) {
              <span class="spinner-xs"></span>
            }
          </div>

          @if (hasMedia) {
            <!-- Primary Image Preview -->
            <div class="primary-media">
              @if (primaryMedia; as media) {
                <div class="media-preview">
                  <img [src]="media.publicUrl" [alt]="media.altText || 'Ana g√∂rsel'" loading="lazy">
                  <div class="media-overlay">
                    <span 
                      class="origin-badge" 
                      [style.background]="getOriginColor(media.origin)"
                    >
                      {{ getOriginLabel(media.origin) }}
                    </span>
                  </div>
                </div>
                <div class="media-info">
                  <span class="media-dimensions">{{ media.width }}√ó{{ media.height }}</span>
                  <span class="media-size">{{ formatFileSize(media.sizeBytes) }}</span>
                </div>
              }
            </div>

            <!-- All Media Assets -->
            @if (mediaAssets().length > 1) {
              <div class="media-list">
                <h4>T√ºm G√∂rseller ({{ mediaAssets().length }})</h4>
                @for (asset of mediaAssets(); track asset.id) {
                  <div class="media-item" [class.primary]="asset.isPrimary">
                    <img [src]="asset.publicUrl" [alt]="asset.altText || 'G√∂rsel'" class="media-thumb">
                    <div class="media-item-info">
                      <span 
                        class="origin-badge-sm" 
                        [style.background]="getOriginColor(asset.origin)"
                      >
                        {{ getOriginLabel(asset.origin) }}
                      </span>
                      @if (asset.isPrimary) {
                        <span class="primary-label">Ana</span>
                      }
                    </div>
                    <div class="media-item-actions">
                      @if (!asset.isPrimary && canApproveRejectSchedule) {
                        <button 
                          class="btn-icon" 
                          title="Ana g√∂rsel yap"
                          (click)="setPrimaryMedia(asset.id)"
                          [disabled]="isSettingPrimary() === asset.id"
                        >
                          @if (isSettingPrimary() === asset.id) {
                            <span class="spinner-xs"></span>
                          } @else {
                            ‚≠ê
                          }
                        </button>
                      }
                      @if (canApproveRejectSchedule) {
                        <button 
                          class="btn-icon btn-icon-danger" 
                          title="Sil"
                          (click)="deleteMedia(asset.id)"
                          [disabled]="isDeletingMedia() === asset.id"
                        >
                          @if (isDeletingMedia() === asset.id) {
                            <span class="spinner-xs"></span>
                          } @else {
                            üóëÔ∏è
                          }
                        </button>
                      }
                    </div>
                  </div>
                }
              </div>
            }
          } @else {
            <!-- Empty State -->
            <div class="media-empty">
              <span class="empty-icon">üñºÔ∏è</span>
              <p>Hen√ºz g√∂rsel yok</p>
            </div>
          }

          <!-- Media Actions -->
          @if (canApproveRejectSchedule) {
            <div class="media-actions">
              <button 
                class="btn-media-action"
                (click)="refreshMediaFromSource()"
                [disabled]="isRefreshingMedia()"
              >
                @if (isRefreshingMedia()) {
                  <span class="spinner-xs"></span>
                } @else {
                  üîÑ
                }
                Kaynak g√∂rseli √ßek
              </button>
              <button 
                class="btn-media-action btn-ai"
                (click)="openAIGenerateModal()"
                [disabled]="isGeneratingMedia()"
              >
                @if (isGeneratingMedia()) {
                  <span class="spinner-xs"></span>
                } @else {
                  ü§ñ
                }
                AI g√∂rsel √ºret
              </button>
            </div>
          }
        </div>

        <!-- AI Video Section -->
        <div class="sidebar-section ai-video-section">
          <div class="section-header">
            <h3>üé¨ AI Video</h3>
            @if (isLoadingVideoStatus()) {
              <span class="spinner-xs"></span>
            }
          </div>

          <!-- Safety Hint -->
          <div class="ai-video-hint">
            <span class="hint-icon">‚ö†Ô∏è</span>
            <span>Ger√ßek ki≈üi adƒ±/logosu kullanmayƒ±n. Sanal sunucu tarzƒ± √ºretim √∂nerilir.</span>
          </div>

          @if (aiVideoJob(); as job) {
            <!-- Video Job Status -->
            <div class="video-job-card" [class]="getVideoStatusClass(job.status)">
              <div class="job-status-row">
                <span class="job-status-label">Durum:</span>
                <span class="job-status-value" [class]="getVideoStatusClass(job.status)">
                  {{ getVideoStatusLabel(job.status) }}
                </span>
              </div>

              @if (job.status === 'InProgress' || job.status === 'Queued') {
                <!-- Progress Bar -->
                <div class="progress-container">
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="job.progress"></div>
                  </div>
                  <span class="progress-text">{{ job.progress }}%</span>
                </div>
                
                <button 
                  class="btn-cancel-video"
                  (click)="cancelVideoGeneration()"
                  [disabled]="isCancellingVideo()"
                >
                  @if (isCancellingVideo()) {
                    <span class="spinner-xs"></span>
                  }
                  ‚ùå ƒ∞ptal Et
                </button>
              }

              @if (job.status === 'Completed' && job.mediaUrl) {
                <!-- Video Preview -->
                <div class="video-preview">
                  <video controls [src]="job.mediaUrl" class="video-player">
                    Tarayƒ±cƒ±nƒ±z video oynatmayƒ± desteklemiyor.
                  </video>
                </div>
                <div class="video-info">
                  <span class="video-model">{{ job.model }}</span>
                  <span class="video-duration">{{ job.seconds }}s</span>
                  <span class="video-size">{{ job.size }}</span>
                </div>
              }

              @if (job.status === 'Failed') {
                <!-- Error State -->
                <div class="video-error">
                  <span class="error-icon">‚ùå</span>
                  <span class="error-text">{{ job.error || 'Bilinmeyen hata' }}</span>
                </div>
                <button 
                  class="btn-retry-video"
                  (click)="retryVideoGeneration()"
                  [disabled]="isGeneratingVideo()"
                >
                  @if (isGeneratingVideo()) {
                    <span class="spinner-xs"></span>
                  }
                  üîÑ Tekrar Dene
                </button>
              }

              <div class="job-meta">
                <span class="job-created">{{ formatDate(job.createdAtUtc) }}</span>
              </div>
            </div>
          } @else {
            <!-- Empty State -->
            <div class="video-empty">
              <span class="empty-icon">üé¨</span>
              <p>Hen√ºz AI video yok</p>
            </div>
          }

          <!-- Generate Video Button -->
          @if (canApproveRejectSchedule) {
            <button 
              class="btn-generate-video"
              (click)="openAIVideoModal()"
              [disabled]="isGeneratingVideo() || (aiVideoJob()?.status === 'InProgress') || (aiVideoJob()?.status === 'Queued')"
            >
              @if (isGeneratingVideo()) {
                <span class="spinner-xs"></span>
              } @else {
                üé¨
              }
              AI Video √úret
            </button>
          }
        </div>

        <div class="sidebar-section">
          <h3>Revisions</h3>
          <div class="revisions-list">
            @for (rev of item()!.revisions; track rev.id) {
              <div class="revision-item">
                <span class="rev-icon">{{ getActionIcon(rev.actionType) }}</span>
                <div class="rev-info">
                  <span class="rev-action">{{ rev.actionType }}</span>
                  <span class="rev-version">v{{ rev.versionNo }}</span>
                </div>
                <span class="rev-date">{{ formatDate(rev.createdAtUtc) }}</span>
              </div>
            } @empty {
              <p class="no-revisions">No revisions yet</p>
            }
          </div>
        </div>

        <div class="sidebar-section">
          <h3>Original Content</h3>
          <div class="original-info">
            <div class="info-row">
              <label>Published</label>
              <span>{{ formatDate(item()!.publishedAtUtc) }}</span>
            </div>
            <div class="info-row">
              <label>Ingested</label>
              <span>{{ formatDate(item()!.ingestedAtUtc) }}</span>
            </div>
            @if (item()!.decisionType) {
              <div class="info-row">
                <label>Decision</label>
                <span>{{ item()!.decisionType }}</span>
              </div>
            }
            @if (item()!.media.length > 0) {
              <div class="info-row">
                <label>Media</label>
                <span>{{ item()!.media.length }} file(s)</span>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }
</div>

<!-- Reject Modal -->
@if (showRejectModal()) {
  <div class="modal-overlay" (click)="closeRejectModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Reject Content</h2>
        <button class="btn-close" (click)="closeRejectModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Rejection Reason *</label>
          <textarea 
            [(ngModel)]="rejectReason" 
            rows="4"
            placeholder="Enter reason for rejection..."
          ></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeRejectModal()">Cancel</button>
        <button 
          class="btn-confirm-reject" 
          (click)="confirmReject()"
          [disabled]="!rejectReason.trim() || isRejecting()"
        >
          @if (isRejecting()) {
            <span class="spinner-sm"></span>
          }
          Reject
        </button>
      </div>
    </div>
  </div>
}

<!-- Schedule Modal -->
@if (showScheduleModal()) {
  <div class="modal-overlay" (click)="closeScheduleModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Schedule Content</h2>
        <button class="btn-close" (click)="closeScheduleModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Schedule Date & Time *</label>
          <input 
            type="datetime-local" 
            [(ngModel)]="scheduleDateTime"
          >
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeScheduleModal()">Cancel</button>
        <button 
          class="btn-confirm-schedule" 
          (click)="confirmSchedule()"
          [disabled]="!scheduleDateTime || isScheduling()"
        >
          @if (isScheduling()) {
            <span class="spinner-sm"></span>
          }
          Schedule
        </button>
      </div>
    </div>
  </div>
}

<!-- Logs Modal -->
@if (showLogsModal()) {
  <div class="modal-overlay" (click)="closeLogsModal()">
    <div class="modal-content logs-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>üìã Publish Logs</h2>
        <button class="btn-close" (click)="closeLogsModal()">‚úï</button>
      </div>
      <div class="modal-body">
        @if (publishLogs().length === 0) {
          <div class="no-logs">
            <p>No publish logs yet</p>
          </div>
        } @else {
          <div class="logs-list">
            @for (log of publishLogs(); track log.id) {
              <div class="log-item" [class]="getStatusClass(log.status)">
                <div class="log-header">
                  <span class="log-channel">
                    {{ getChannelIcon(log.channel) }} {{ log.channel }}
                  </span>
                  <span class="log-status" [class]="getStatusClass(log.status)">
                    {{ log.status }}
                  </span>
                  @if (getSkippedReason(log); as reason) {
                    <span class="log-skip-reason">({{ reason }})</span>
                  }
                  <span class="log-date">{{ formatDate(log.createdAtUtc) }}</span>
                </div>
                @if (log.error) {
                  <div class="log-error">
                    <strong>Error:</strong> {{ log.error }}
                  </div>
                }
                @if (log.responseJson) {
                  <details class="log-details">
                    <summary>Response</summary>
                    <pre>{{ log.responseJson }}</pre>
                  </details>
                }
              </div>
            }
          </div>
        }
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeLogsModal()">Close</button>
      </div>
    </div>
  </div>
}

<!-- Correction Modal -->
@if (showCorrectionModal()) {
  <div class="modal-overlay" (click)="closeCorrectionModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>üìù Save Correction</h2>
        <button class="btn-close" (click)="closeCorrectionModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="correction-summary">
          <p>You are about to save a correction for this published content. This will:</p>
          <ul>
            <li>Create a new revision with your current edits</li>
            <li>Queue the content for republishing to enabled channels</li>
          </ul>
        </div>
        <div class="form-group">
          <label>Correction Note (optional)</label>
          <textarea 
            [(ngModel)]="correctionNote" 
            rows="3"
            placeholder="Describe what was corrected..."
          ></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeCorrectionModal()">Cancel</button>
        <button 
          class="btn-confirm-correction" 
          (click)="submitCorrection()"
          [disabled]="isCorrecting()"
        >
          @if (isCorrecting()) {
            <span class="spinner-sm"></span>
          }
          Save & Republish
        </button>
      </div>
    </div>
  </div>
}

<!-- Retract Modal -->
@if (showRetractModal()) {
  <div class="modal-overlay" (click)="closeRetractModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>üö´ Retract Content</h2>
        <button class="btn-close" (click)="closeRetractModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="retract-warning">
          <span class="warning-icon">‚ö†Ô∏è</span>
          <p><strong>Warning:</strong> Retracting content will remove it from all published channels. This action is logged and cannot be easily undone.</p>
        </div>
        <div class="form-group">
          <label>Retraction Reason *</label>
          <textarea 
            [(ngModel)]="retractReason" 
            rows="4"
            placeholder="Why is this content being retracted?"
          ></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeRetractModal()">Cancel</button>
        <button 
          class="btn-confirm-retract" 
          (click)="submitRetract()"
          [disabled]="!retractReason.trim() || isRetracting()"
        >
          @if (isRetracting()) {
            <span class="spinner-sm"></span>
          }
          Retract Content
        </button>
      </div>
    </div>
  </div>
}

<!-- Breaking News Modal -->
@if (showBreakingModal()) {
  <div class="modal-overlay" (click)="closeBreakingModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>üî¥ Mark as Breaking News</h2>
        <button class="btn-close" (click)="closeBreakingModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="breaking-info">
          <p>Marking content as breaking will fast-track it through the publishing workflow.</p>
        </div>
        <div class="form-group">
          <label>Breaking Note</label>
          <textarea 
            [(ngModel)]="breakingNote" 
            rows="3"
            placeholder="Why is this breaking news?"
          ></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Priority</label>
            <input 
              type="number" 
              [(ngModel)]="breakingPriority"
              min="1"
              max="1000"
            >
            <span class="hint">Higher = more urgent (100 = normal)</span>
          </div>
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="breakingPushRequired">
              <span>Push notification required</span>
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeBreakingModal()">Cancel</button>
        <button 
          class="btn-confirm-breaking" 
          (click)="submitMarkBreaking()"
          [disabled]="isMarkingBreaking()"
        >
          @if (isMarkingBreaking()) {
            <span class="spinner-sm"></span>
          }
          Mark as Breaking
        </button>
      </div>
    </div>
  </div>
}

<!-- AI Generate Modal -->
@if (showAIGenerateModal()) {
  <div class="modal-overlay" (click)="closeAIGenerateModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>ü§ñ AI G√∂rsel Olu≈ütur</h2>
        <button class="btn-close" (click)="closeAIGenerateModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="ai-info">
          <p>Yapay zeka, i√ßeriƒüe uygun soyut bir haber ill√ºstrasyonu olu≈üturacak. Ger√ßek insan y√ºzleri veya logolar i√ßermez.</p>
        </div>
        <div class="form-group">
          <label>√ñzel Prompt (Opsiyonel)</label>
          <textarea 
            [(ngModel)]="aiPromptOverride" 
            rows="4"
            placeholder="Bo≈ü bƒ±rakƒ±rsanƒ±z i√ßerik ba≈ülƒ±ƒüƒ±ndan otomatik olu≈üturulur..."
          ></textarea>
          <span class="hint">√ñrn: "Modern ve minimalist bir teknoloji ill√ºstrasyonu, mavi tonlar"</span>
        </div>
        <div class="form-group">
          <label>Stil √ñn Ayarƒ±</label>
          <select [(ngModel)]="aiStylePreset">
            <option value="news-illustration">Haber ƒ∞ll√ºstrasyonu</option>
            <option value="abstract">Soyut</option>
            <option value="minimalist">Minimalist</option>
            <option value="tech">Teknoloji</option>
            <option value="business">ƒ∞≈ü D√ºnyasƒ±</option>
          </select>
        </div>
        @if (hasMedia) {
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="aiForce">
              <span>Mevcut g√∂rseli yenisiyle deƒüi≈ütir (zorla)</span>
            </label>
            <span class="hint">ƒ∞≈üaretli deƒüilse ve zaten bir ana g√∂rsel varsa, yeni g√∂rsel olu≈üturulmaz</span>
          </div>
        }
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeAIGenerateModal()">ƒ∞ptal</button>
        <button 
          class="btn-confirm-ai" 
          (click)="submitAIGenerate()"
          [disabled]="isGeneratingMedia()"
        >
          @if (isGeneratingMedia()) {
            <span class="spinner-sm"></span>
          }
          G√∂rsel Olu≈ütur
        </button>
      </div>
    </div>
  </div>
}

<!-- AI Video Modal -->
@if (showAIVideoModal()) {
  <div class="modal-overlay" (click)="closeAIVideoModal()">
    <div class="modal-content ai-video-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>üé¨ AI Video Olu≈ütur</h2>
        <button class="btn-close" (click)="closeAIVideoModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="ai-video-warning">
          <span class="warning-icon">‚ö†Ô∏è</span>
          <p><strong>Uyarƒ±:</strong> Ger√ßek ki≈üi adƒ± veya logosu kullanmayƒ±n. Sanal sunucu tarzƒ± √ºretim √∂nerilir.</p>
        </div>

        <!-- Mode Selector -->
        <div class="form-group">
          <label>Prompt Modu</label>
          <div class="mode-selector">
            <label class="mode-option">
              <input 
                type="radio" 
                name="videoMode" 
                value="AutoPrompt" 
                [(ngModel)]="videoMode"
                (change)="onVideoModeChange()"
              >
              <span>ü§ñ Otomatik Prompt</span>
            </label>
            <label class="mode-option">
              <input 
                type="radio" 
                name="videoMode" 
                value="CustomPrompt" 
                [(ngModel)]="videoMode"
                (change)="onVideoModeChange()"
              >
              <span>‚úèÔ∏è √ñzel Prompt</span>
            </label>
          </div>
        </div>

        <!-- Prompt Area -->
        <div class="form-group">
          <label>
            @if (videoMode === 'AutoPrompt') {
              Prompt √ñnizlemesi (d√ºzenlenebilir)
            } @else {
              √ñzel Prompt
            }
          </label>
          <textarea 
            [(ngModel)]="videoMode === 'AutoPrompt' ? videoPromptPreview : videoPromptOverride" 
            rows="6"
            [placeholder]="videoMode === 'AutoPrompt' ? 'Y√ºkleniyor...' : 'Video i√ßin prompt yazƒ±n...'"
          ></textarea>
          @if (videoMode === 'AutoPrompt') {
            <span class="hint">ƒ∞√ßerik ba≈ülƒ±ƒüƒ±ndan otomatik olu≈üturuldu. D√ºzenleyebilirsiniz.</span>
          } @else {
            <span class="hint">Kendi prompt'unuzu yazƒ±n. G√ºvenlik kurallarƒ± otomatik eklenir.</span>
          }
        </div>

        <!-- Settings Row -->
        <div class="video-settings-row">
          <div class="form-group">
            <label>Model</label>
            <select [(ngModel)]="videoModel">
              <option value="sora-2">Sora 2</option>
              <option value="sora-2-pro">Sora 2 Pro</option>
            </select>
          </div>
          <div class="form-group">
            <label>S√ºre</label>
            <select [(ngModel)]="videoSeconds">
              <option value="4">4 saniye</option>
              <option value="8">8 saniye</option>
              <option value="12">12 saniye</option>
            </select>
          </div>
          <div class="form-group">
            <label>Boyut</label>
            <select [(ngModel)]="videoSize">
              <option value="1280x720">1280√ó720 (Yatay)</option>
              <option value="720x1280">720√ó1280 (Dikey)</option>
              <option value="1792x1024">1792√ó1024 (Geni≈ü)</option>
              <option value="1024x1792">1024√ó1792 (Uzun)</option>
            </select>
          </div>
        </div>

        @if (aiVideoJob()) {
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="videoForce">
              <span>Mevcut videoyu yenisiyle deƒüi≈ütir (zorla)</span>
            </label>
            <span class="hint">ƒ∞≈üaretli deƒüilse ve zaten tamamlanmƒ±≈ü bir video varsa, yeni video olu≈üturulmaz</span>
          </div>
        }
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeAIVideoModal()">ƒ∞ptal</button>
        <button 
          class="btn-confirm-video" 
          (click)="generateAiVideo()"
          [disabled]="isGeneratingVideo()"
        >
          @if (isGeneratingVideo()) {
            <span class="spinner-sm"></span>
          }
          üé¨ Video Olu≈ütur
        </button>
      </div>
    </div>
  </div>
}

<!-- Toast -->
@if (showToast()) {
  <div class="toast" [class]="toastType()">
    {{ toastMessage() }}
  </div>
}


